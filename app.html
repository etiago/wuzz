<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
        </title>
        
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
        <link rel="stylesheet" href="my.css" />
        <link rel="stylesheet" href="css/jquery.jqplot.min.css" />
        <style>
            /* App custom styles */
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
        </script>
        <script type="text/javascript">
        	$(document).bind("mobileinit", function(){
				$( 'div[data-role="page"]' ).live( 'pageshow',function(event, ui){
					window.pageID = event.target.id;
					
					if (!(typeof window.iosocket === 'undefined') && window.iosocket !== null) {
						// Ask the server for a status update
						window.iosocket.emit("status", {});
					}
					

				});
			});
		</script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.0/jquery.mobile-1.1.0.min.js">
        </script>
        <script src="js/jquery.jqplot.min.js"></script>
        <script src="js/jqplot.pieRenderer.min.js"></script>
        <script src="http://prometheus.espinha.pt/socket.io/socket.io.js"></script>
        <script src="my.js">
        </script>
        <script>
	        window.onload = function() {
	        	var socket = io.connect('http://prometheus.espinha.pt:80');
	        	window.iosocket = socket;
	        	
			  	socket.on("question",function (questionData) {
					var questionText = questionData["question"];
					$("#questionTitle").html(questionText);
				
					$.each(questionData["answers"], function(index, value) {
						  index++;
						  $("#answer"+index+" .ui-btn-text").html(value);
						  $("#answer"+index).css("display","block");
					});
					
					window.tickID = setInterval((function(secondsLeft) {
							return function() {
								secondsLeft--;
								if (secondsLeft == 0) {
									clearInterval(window.tickID);
									delete(window.tickID);
									
									setTimeout((function(){return function() {window.iosocket.emit("status", {})};})(),3000);
								}
								$("#timeLeft").html("Time left: "+secondsLeft+" seconds.");
							};
						})(questionData["secondsLeft"]),1000);
					
				});
				
				var photoName = "";
				socket.on("photo", function (data) {
						if (window.pageID != "photo" ) {
							$.mobile.changePage("photo.html");
						} else {
							$("#photoSlot").html("<img style=\"width:100%;\" src=\"photos/"+data["photoName"]+"\" />");
						}
					}
				);
				
				socket.on("graph", function (data) {
					if (window.pageID != "graph" ) {
						$.mobile.changePage("graph.html");
					} else {
						var graphData = new Array();
						graphData[0] = new Array();
						
						$.each( data.results, function(i, n){
							graphData[0].push([data.answers[i],n]);
						});
						$("#graphTitle").html("Results for \""+data.question+"\"");
						
						var plot1 = $.jqplot('pie1', graphData, {
					        gridPadding: {top:0, bottom:38, left:0, right:0},
					        seriesDefaults:{
					            renderer:$.jqplot.PieRenderer, 
					            trendline:{ show:false }, 
					            rendererOptions: { padding: 8, showDataLabels: true }
					        },
					        legend:{
					            show:true, 
					            placement: 'outside', 
					            rendererOptions: {
					                numberRows: 1
					            }, 
					            location:'s',
					            marginTop: '15px'
					        }       
					    });
					}
				});
				
				// Ask the server for a status update
				socket.emit("status", {});
				
	        	$("#answer1").click(function (e) {
				    e.stopImmediatePropagation();
				    e.preventDefault();
				    alert("ya")
				    //Do important stuff....
				});
			}
        </script>
    </head>
    <body>
        <!-- Home -->
        <div data-role="page" id="question">
            <div data-theme="a" data-role="header" data-position="fixed">
                <h3>
                    Buzz!
                </h3>
            </div>
            <div id="container" data-role="content" style="padding: 15px">
                <h2 id="questionTitle">
                    Question
                </h2>
                <a data-role="button" data-transition="slide" data-theme="b" id="answer1" style="display:none;">Answer</a>
                <a data-role="button" data-transition="slide" data-theme="b" id="answer2" style="display:none;">Answer</a>
                <a data-role="button" data-transition="slide" data-theme="b" id="answer3" style="display:none;">Answer</a>
                <a data-role="button" data-transition="slide" data-theme="b" id="answer4" style="display:none;">Answer</a>
                
            </div>
            <div data-theme="a" data-role="footer" data-position="fixed">
                <h3 id="timeLeft">
                    Time left:
                </h3>
            </div>
        </div>
        <script>
            //App custom javascript
        </script>
    </body>
</html>